<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prosjekt ROBUST Skole ‚Äì Antifragilitet og Livsmestring</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .chart-container { 
            position: relative; 
            width: 100%; 
            max-width: 600px; 
            margin-left: auto; 
            margin-right: auto; 
            height: 300px; 
            max-height: 400px; 
        } 
        @media (min-width: 768px) { 
            .chart-container { height: 400px; } 
        }
        .card-hover:hover { transform: translateY(-2px); transition: all 0.3s ease; }
        .active-nav { border-bottom: 2px solid #ea580c; color: #ea580c; font-weight: 600; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Loading spinner for AI */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #ea580c;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <!-- Chosen Palette: Warm Neutrals with "Rust/Clay" Accents. 
         Background: Slate-50/White. 
         Primary Text: Slate-800. 
         Accent: Orange-600 (Rust) for vitality/growth. 
         Secondary: Stone-200. -->
    
    <!-- Application Structure Plan:
         1. Hero Section: Introduces "Prosjekt ROBUST Skole".
         2. "Diagnosen" (The Problem): Interactive cards (Safetyism etc).
         3. "Vekstmatrisen" (The Model): Chart.js Bubble Chart.
         4. "Praksisendring" (Implementation): Toggle/table.
         5. "Fundamentet" (LK20 Roots): Values.
         6. "AI-Verkt√∏ykasse" (NEW): Gemini API powered tools for teachers.
         Why this structure? Narrative flow + practical application at the end.
    -->

    <!-- Visualization & Content Choices:
         ...existing choices...
         5. AI Tools: Interactive forms + Gemini API calls. Goal: Make the theory operational.
         CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
</head>
<body class="bg-slate-50 text-slate-800 leading-relaxed">

    <!-- Navigation -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-slate-900 tracking-tight">ROBUST <span class="text-orange-600">Skole</span></span>
                </div>
                <div class="hidden sm:flex space-x-8 items-center">
                    <button onclick="scrollToSection('intro')" class="nav-item active-nav text-slate-600 hover:text-orange-600 px-3 py-2 text-sm font-medium">Intro</button>
                    <button onclick="scrollToSection('diagnosen')" class="nav-item text-slate-600 hover:text-orange-600 px-3 py-2 text-sm font-medium">Diagnosen</button>
                    <button onclick="scrollToSection('modellen')" class="nav-item text-slate-600 hover:text-orange-600 px-3 py-2 text-sm font-medium">L√¶ringssonen</button>
                    <button onclick="scrollToSection('praksis')" class="nav-item text-slate-600 hover:text-orange-600 px-3 py-2 text-sm font-medium">Praksis</button>
                    <button onclick="scrollToSection('aitools')" class="nav-item text-slate-600 hover:text-orange-600 px-3 py-2 text-sm font-medium flex items-center gap-1">AI Verkt√∏y ‚ú®</button>
                </div>
                <!-- Mobile menu button stub -->
                <div class="flex items-center sm:hidden">
                    <button onclick="toggleMobileMenu()" class="text-slate-500 hover:text-slate-700 focus:outline-none">
                        ‚ò∞
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden sm:hidden bg-white border-t border-gray-200">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <button onclick="scrollToSection('intro')" class="block w-full text-left px-3 py-2 text-base font-medium text-slate-700 hover:bg-orange-50 hover:text-orange-600">Intro</button>
                <button onclick="scrollToSection('diagnosen')" class="block w-full text-left px-3 py-2 text-base font-medium text-slate-700 hover:bg-orange-50 hover:text-orange-600">Diagnosen</button>
                <button onclick="scrollToSection('modellen')" class="block w-full text-left px-3 py-2 text-base font-medium text-slate-700 hover:bg-orange-50 hover:text-orange-600">L√¶ringssonen</button>
                <button onclick="scrollToSection('praksis')" class="block w-full text-left px-3 py-2 text-base font-medium text-slate-700 hover:bg-orange-50 hover:text-orange-600">Praksis</button>
                <button onclick="scrollToSection('aitools')" class="block w-full text-left px-3 py-2 text-base font-medium text-slate-700 hover:bg-orange-50 hover:text-orange-600">AI Verkt√∏y ‚ú®</button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="intro" class="pt-16 pb-12 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-6">
                Fra Beskyttelse til <span class="text-orange-600">Vekst</span>
            </h1>
            <p class="text-xl text-slate-600 max-w-3xl mx-auto mb-10">
                Hvordan ruster vi elevene for livet? <strong>Prosjekt ROBUST Skole</strong> er en modell for antifragilitet og livsmestring, direkte forankret i <em>Overordnet del</em> av l√¶replanverket. Vi beveger oss fra √• skjerme elevene mot ubehag, til √• l√¶re dem √• mestre det.
            </p>
            <div class="flex justify-center gap-4">
                <button onclick="scrollToSection('diagnosen')" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-8 rounded-full transition shadow-lg">
                    Utforsk Modellen
                </button>
            </div>
        </div>
    </section>

    <!-- Section 1: Diagnosen (The Problem) -->
    <section id="diagnosen" class="py-16 bg-slate-50 border-t border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-slate-900">1. Utfordringen: Hvorfor trenger vi ROBUST?</h2>
                <p class="mt-4 text-lg text-slate-600 max-w-2xl mx-auto">
                    Dagens skolekultur preges ofte av gode intensjoner som utilsiktet kan skape uselvstendighet. Klikk p√• kortene under for √• se mekanismene vi m√• motvirke.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Card 1 -->
                <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-100 card-hover cursor-pointer" onclick="updateDiagnosisDetails('safetyism')">
                    <div class="text-4xl mb-4">üõ°Ô∏è</div>
                    <h3 class="text-xl font-bold text-slate-900 mb-2">Safetyism</h3>
                    <p class="text-slate-600">En kultur preget av overdreven beskyttelse.</p>
                    <p class="text-sm text-orange-600 mt-4 font-semibold">Les mer ‚Üí</p>
                </div>
                <!-- Card 2 -->
                <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-100 card-hover cursor-pointer" onclick="updateDiagnosisDetails('comfort')">
                    <div class="text-4xl mb-4">üõãÔ∏è</div>
                    <h3 class="text-xl font-bold text-slate-900 mb-2">Komfortfellen</h3>
                    <p class="text-slate-600">Prioritering av f√∏lelsesmessig komfort over vekst.</p>
                    <p class="text-sm text-orange-600 mt-4 font-semibold">Les mer ‚Üí</p>
                </div>
                <!-- Card 3 -->
                <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-100 card-hover cursor-pointer" onclick="updateDiagnosisDetails('helplessness')">
                    <div class="text-4xl mb-4">üß©</div>
                    <h3 class="text-xl font-bold text-slate-900 mb-2">L√¶rt Hjelpel√∏shet</h3>
                    <p class="text-slate-600">N√•r voksne rydder veien, slutter barn √• g√• selv.</p>
                    <p class="text-sm text-orange-600 mt-4 font-semibold">Les mer ‚Üí</p>
                </div>
            </div>

            <!-- Dynamic Details Panel -->
            <div id="diagnosis-detail" class="mt-10 bg-orange-50 rounded-xl p-8 border-l-4 border-orange-600 hidden fade-in">
                <h3 id="diag-title" class="text-2xl font-bold text-slate-900 mb-3">Tittel</h3>
                <p id="diag-content" class="text-slate-700 text-lg">Innhold...</p>
                <div class="mt-6 p-4 bg-white rounded-lg shadow-inner">
                    <span class="font-bold text-slate-900">L√∏sningen i ROBUST Skole:</span>
                    <span id="diag-solution" class="text-slate-700 ml-2 italic">L√∏sning...</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 2: Modellen (The Solution/Chart) -->
    <section id="modellen" class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                <div>
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">2. L√∏sningen: Antifragilitet i Praksis</h2>
                    <p class="text-lg text-slate-600 mb-6">
                        For at elever skal utvikle <strong>livsmestring</strong> (LK20), m√• de oppleve <em>produktivt strev</em>. Vi m√• balansere st√∏tte og utfordring for √• treffe "L√¶ringssonen".
                    </p>
                    <p class="text-slate-600 mb-6">
                        Utforsk diagrammet til h√∏yre ved √• klikke p√• boblene. Diagrammet viser forholdet mellom l√¶rers st√∏tte og oppgavens utfordring.
                    </p>
                    
                    <div id="zone-info" class="bg-slate-50 p-6 rounded-lg border border-slate-200 shadow-sm transition-all">
                        <h4 class="font-bold text-lg text-slate-900 mb-2">Velg en sone i diagrammet</h4>
                        <p class="text-slate-600 text-sm">Klikk p√• en av sirklene for √• se pedagogiske strategier for den sonen.</p>
                    </div>
                </div>

                <div class="flex flex-col items-center justify-center bg-slate-50 rounded-xl p-4 border border-slate-100 shadow-inner">
                    <h3 class="text-center font-bold text-slate-500 mb-4 text-sm uppercase tracking-wide">Vekstmatrisen</h3>
                    <div class="chart-container">
                        <canvas id="growthChart"></canvas>
                    </div>
                    <div class="mt-4 flex gap-4 text-xs text-slate-500">
                        <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-slate-300 mr-1"></span> Komfort</div>
                        <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-orange-500 mr-1"></span> ROBUST L√¶ring</div>
                        <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-red-400 mr-1"></span> Overveldelse</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 3: Implementering (Table) -->
    <section id="praksis" class="py-16 bg-slate-50 border-t border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-slate-900">3. Implementering: Fra Tradisjonell til ROBUST</h2>
                <p class="mt-4 text-slate-600 max-w-2xl mx-auto">
                    Hvordan endrer vi skolehverdagen i praksis? Bruk bryteren under for √• se skiftet.
                </p>
            </div>

            <!-- Toggle Switch -->
            <div class="flex justify-center mb-8">
                <div class="bg-white p-1 rounded-full shadow border border-slate-200 inline-flex">
                    <button id="btn-trad" onclick="setMode('traditional')" class="px-6 py-2 rounded-full text-sm font-bold transition-colors bg-slate-100 text-slate-500">
                        Tradisjonell Praksis
                    </button>
                    <button id="btn-robust" onclick="setMode('robust')" class="px-6 py-2 rounded-full text-sm font-bold transition-colors text-slate-500 hover:text-orange-600">
                        ROBUST Praksis
                    </button>
                </div>
            </div>

            <!-- Comparison Cards Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" id="comparison-grid">
                <!-- Dimension 1: Tid -->
                <div class="bg-white rounded-xl shadow-sm p-6 border-t-4 border-slate-300 transition-all duration-500" id="card-tid">
                    <div class="text-2xl mb-3">‚è±Ô∏è</div>
                    <h4 class="font-bold text-slate-900 mb-2">Tid</h4>
                    <p class="text-sm text-slate-600 content-text">Fragmentert og klokkestyrt hverdag.</p>
                </div>
                <!-- Dimension 2: L√¶rerrollen -->
                <div class="bg-white rounded-xl shadow-sm p-6 border-t-4 border-slate-300 transition-all duration-500" id="card-rolle">
                    <div class="text-2xl mb-3">üë©‚Äçüè´</div>
                    <h4 class="font-bold text-slate-900 mb-2">L√¶rerrollen</h4>
                    <p class="text-sm text-slate-600 content-text">Instrukt√∏r og probleml√∏ser for eleven.</p>
                </div>
                <!-- Dimension 3: Vurdering -->
                <div class="bg-white rounded-xl shadow-sm p-6 border-t-4 border-slate-300 transition-all duration-500" id="card-vurdering">
                    <div class="text-2xl mb-3">üìù</div>
                    <h4 class="font-bold text-slate-900 mb-2">Vurdering</h4>
                    <p class="text-sm text-slate-600 content-text">Prestasjonsfokus og sluttresultat.</p>
                </div>
                <!-- Dimension 4: Ansvar -->
                <div class="bg-white rounded-xl shadow-sm p-6 border-t-4 border-slate-300 transition-all duration-500" id="card-ansvar">
                    <div class="text-2xl mb-3">üå±</div>
                    <h4 class="font-bold text-slate-900 mb-2">Ansvar</h4>
                    <p class="text-sm text-slate-600 content-text">Risikoaversjon: Voksne tar ansvar for risiko.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 4: Fundamentet (LK20) -->
    <section id="fundament" class="py-16 bg-white border-t border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-12">
                <div class="md:col-span-1">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">4. Fundamentet</h2>
                    <p class="text-slate-600 mb-4">
                        ROBUST Skole er ikke noe "nytt" som kommer p√• toppen. Det er en realisering av verdigrunnlaget i <strong>Overordnet del</strong>.
                    </p>
                    <div class="p-4 bg-orange-50 rounded-lg border border-orange-100">
                        <p class="text-sm text-orange-800 italic">
                            "Skolen skal la elevene utfolde skaperglede, engasjement og utforskertrang."
                        </p>
                        <p class="text-xs text-orange-600 font-bold mt-2 text-right">‚Äì Overordnet del</p>
                    </div>
                </div>
                
                <div class="md:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <!-- Value 1 -->
                    <div class="flex items-start">
                        <div class="flex-shrink-0 bg-slate-100 rounded-lg p-3">
                            <span class="text-2xl">ü§ù</span>
                        </div>
                        <div class="ml-4">
                            <h4 class="text-lg font-bold text-slate-900">Menneskeverdet</h4>
                            <p class="text-slate-600 text-sm mt-1">Elevene m√∏tes med tillit og h√∏ye forventninger. Vi tror de kan klare det.</p>
                        </div>
                    </div>
                    <!-- Value 2 -->
                    <div class="flex items-start">
                        <div class="flex-shrink-0 bg-slate-100 rounded-lg p-3">
                            <span class="text-2xl">üèîÔ∏è</span>
                        </div>
                        <div class="ml-4">
                            <h4 class="text-lg font-bold text-slate-900">Reell Livsmestring</h4>
                            <p class="text-slate-600 text-sm mt-1">Evnen til √• t√•le motgang, ikke frav√¶r av det. √Ö st√• i stormen.</p>
                        </div>
                    </div>
                    <!-- Value 3 -->
                    <div class="flex items-start">
                        <div class="flex-shrink-0 bg-slate-100 rounded-lg p-3">
                            <span class="text-2xl">üîç</span>
                        </div>
                        <div class="ml-4">
                            <h4 class="text-lg font-bold text-slate-900">Utforskertrang</h4>
                            <p class="text-slate-600 text-sm mt-1">L√¶ring oppst√•r n√•r elevene selv m√• finne l√∏sninger p√• komplekse problemer.</p>
                        </div>
                    </div>
                    <!-- Value 4 -->
                    <div class="flex items-start">
                        <div class="flex-shrink-0 bg-slate-100 rounded-lg p-3">
                            <span class="text-2xl">üèóÔ∏è</span>
                        </div>
                        <div class="ml-4">
                            <h4 class="text-lg font-bold text-slate-900">Profesjonsfellesskapet</h4>
                            <p class="text-slate-600 text-sm mt-1">L√¶rere reflekterer sammen over hvordan praksis faktisk p√•virker elevenes utholdenhet.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 5: AI Verkt√∏ykasse (GEMINI INTEGRATION) -->
    <section id="aitools" class="py-16 bg-slate-900 text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-10">
                <span class="bg-orange-600 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider mb-2 inline-block">Powered by Gemini AI</span>
                <h2 class="text-3xl font-bold text-white mt-2">5. AI-Verkt√∏ykasse for L√¶rere ‚ú®</h2>
                <p class="mt-4 text-slate-400 max-w-2xl mx-auto">
                    Bruk kunstig intelligens til √• trene p√• krevende situasjoner eller designe undervisning som fremmer produktivt strev.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Tool 1: Scenario Simulator -->
                <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 shadow-lg">
                    <div class="flex items-center mb-4">
                        <span class="text-2xl mr-3">üé≠</span>
                        <h3 class="text-xl font-bold text-white">Scenario-Simulatoren</h3>
                    </div>
                    <p class="text-sm text-slate-400 mb-4">
                        Beskriv en krevende situasjon med en elev. Se forskjellen p√• en "beskyttende" og en "ROBUST" respons.
                    </p>
                    <textarea id="scenario-input" rows="3" class="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:outline-none focus:border-orange-500 mb-4" placeholder="F.eks: Eleven gir opp med en gang matematikkoppgaven blir vanskelig..."></textarea>
                    <button onclick="runScenarioSimulation()" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 rounded-lg transition flex justify-center items-center gap-2">
                        <span id="scenario-btn-text">Generer Responser ‚ú®</span>
                        <div id="scenario-loader" class="loader hidden"></div>
                    </button>
                    
                    <!-- Output Area -->
                    <div id="scenario-output" class="mt-6 space-y-4 hidden">
                        <div class="bg-red-900/30 border border-red-800/50 p-4 rounded-lg">
                            <h4 class="text-red-400 font-bold text-sm uppercase mb-1">Tradisjonell / Beskyttende Respons</h4>
                            <p id="scenario-trad-text" class="text-slate-300 text-sm italic">...</p>
                        </div>
                        <div class="bg-green-900/30 border border-green-800/50 p-4 rounded-lg">
                            <h4 class="text-green-400 font-bold text-sm uppercase mb-1">ROBUST Respons (Anbefalt)</h4>
                            <p id="scenario-robust-text" class="text-slate-300 text-sm">...</p>
                        </div>
                    </div>
                </div>

                <!-- Tool 2: Lesson Booster -->
                <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 shadow-lg">
                    <div class="flex items-center mb-4">
                        <span class="text-2xl mr-3">üöÄ</span>
                        <h3 class="text-xl font-bold text-white">Leksjons-Forsterkeren</h3>
                    </div>
                    <p class="text-sm text-slate-400 mb-4">
                        Hva skal du undervise i? F√• 3 tips til hvordan du kan legge inn "produktivt strev" i timen.
                    </p>
                    <input type="text" id="lesson-input" class="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:outline-none focus:border-orange-500 mb-4" placeholder="F.eks: Den franske revolusjon, Fotosyntese...">
                    <button onclick="runLessonBooster()" class="w-full bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 rounded-lg transition flex justify-center items-center gap-2">
                        <span id="lesson-btn-text">Legg til Produktivt Strev ‚ú®</span>
                        <div id="lesson-loader" class="loader hidden" style="border-top-color: #fff;"></div>
                    </button>

                    <!-- Output Area -->
                    <div id="lesson-output" class="mt-6 hidden">
                        <h4 class="text-orange-400 font-bold text-sm uppercase mb-2">Forslag til dybdel√¶ring:</h4>
                        <ul id="lesson-list" class="space-y-3 text-sm text-slate-300 list-disc pl-5">
                            <!-- Items inserted by JS -->
                        </ul>
                    </div>
                </div>
            </div>
            
            <p class="text-center text-slate-500 text-xs mt-8">NB: Generert av AI. Bruk faglig skj√∏nn.</p>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-300 py-12 border-t border-slate-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-2xl font-bold text-white mb-4">Prosjekt ROBUST Skole</h2>
            <p class="mb-8 max-w-xl mx-auto text-slate-400">
                En fremtid der elever trives med usikkerhet, ser p√• feil som informasjon, og har handlekraft til √• forme sine egne liv.
            </p>
            <div class="border-t border-slate-800 pt-8 text-sm">
                Basert p√• Overordnet del av l√¶replanverket &copy; 2024
            </div>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- GEMINI API INTEGRATION ---
        const apiKey = ""; // Set at runtime by environment

        async function callGemini(promptText) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: promptText }] }]
                    })
                });

                if (!response.ok) throw new Error('API request failed');
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini Error:", error);
                return null;
            }
        }

        // TOOL 1: Scenario Simulator
        async function runScenarioSimulation() {
            const input = document.getElementById('scenario-input').value;
            if(!input) return alert("Vennligst beskriv en situasjon f√∏rst.");

            const btnText = document.getElementById('scenario-btn-text');
            const loader = document.getElementById('scenario-loader');
            const outputDiv = document.getElementById('scenario-output');

            // UI Loading State
            btnText.innerText = "Tenker...";
            loader.classList.remove('hidden');
            outputDiv.classList.add('hidden');

            const prompt = `Du er en ekspert p√• pedagogikk basert p√• antifragilitet og 'ROBUST Skole'-modellen. En l√¶rer beskriver denne situasjonen i klasserommet: '${input}'. 
            Generer to responser p√• norsk:
            1. En 'Tradisjonell' respons som kjennetegnes av 'Safetyism' (beskytte mot ubehag, fjerne hinderet, tr√∏ste fremfor √• utfordre).
            2. En 'ROBUST' respons som st√∏tter eleven til √• st√• i ubehaget, bruke 'produktivt strev', og finne l√∏sningen selv (livsmestring).
            Returner KUN valid JSON p√• dette formatet: { "traditional": "...", "robust": "..." }`;

            const resultText = await callGemini(prompt);

            // Clean up JSON string (remove markdown blocks if present)
            let cleanJson = resultText.replace(/```json/g, '').replace(/```/g, '').trim();
            
            try {
                const result = JSON.parse(cleanJson);
                document.getElementById('scenario-trad-text').innerText = result.traditional;
                document.getElementById('scenario-robust-text').innerText = result.robust;
                outputDiv.classList.remove('hidden');
            } catch (e) {
                alert("Beklager, klarte ikke generere respons akkurat n√•.");
            }

            // UI Reset State
            btnText.innerText = "Generer Responser ‚ú®";
            loader.classList.add('hidden');
        }

        // TOOL 2: Lesson Booster
        async function runLessonBooster() {
            const input = document.getElementById('lesson-input').value;
            if(!input) return alert("Vennligst skriv inn et tema.");

            const btnText = document.getElementById('lesson-btn-text');
            const loader = document.getElementById('lesson-loader');
            const outputDiv = document.getElementById('lesson-output');
            const list = document.getElementById('lesson-list');

            // UI Loading State
            btnText.innerText = "Tenker...";
            loader.classList.remove('hidden');
            outputDiv.classList.add('hidden');

            const prompt = `Du er en pedagogisk veileder for 'Prosjekt ROBUST Skole'. En l√¶rer vil undervise i temaet: '${input}'. 
            Foresl√• 3 konkrete, korte grep for √• gj√∏re dette undervisningsopplegget mer 'ROBUST' ved √• innf√∏re 'produktivt strev' (desirable difficulties) eller √∏kt kognitiv motstand. 
            Svaret skal v√¶re p√• norsk. Returner KUN valid JSON som en liste med strenger: ["tips 1", "tips 2", "tips 3"]`;

            const resultText = await callGemini(prompt);
             // Clean up JSON string
            let cleanJson = resultText.replace(/```json/g, '').replace(/```/g, '').trim();

            try {
                const tips = JSON.parse(cleanJson);
                list.innerHTML = "";
                tips.forEach(tip => {
                    const li = document.createElement('li');
                    li.innerText = tip;
                    list.appendChild(li);
                });
                outputDiv.classList.remove('hidden');
            } catch (e) {
                alert("Beklager, klarte ikke generere tips akkurat n√•.");
            }

             // UI Reset State
             btnText.innerText = "Legg til Produktivt Strev ‚ú®";
             loader.classList.add('hidden');
        }

        // --- EXISTING DATA & STATE ---
        const diagnosisData = {
            'safetyism': {
                title: 'Safetyism (Overbeskyttelse)',
                content: 'En kultur hvor vi systematisk fjerner risiko og ubehag for √• "skjerme" elevene. Dette fratar dem muligheten til √• utvikle immunforsvar mot motgang.',
                solution: 'Vi m√• eksponere elever for h√•ndterbar risiko (Antifragilitet).'
            },
            'comfort': {
                title: 'Komfortfellen',
                content: 'Tendensen til √• prioritere at elevene skal "ha det bra" her og n√•, fremfor √• utfordre dem intellektuelt. Dette f√∏rer til kognitiv latskap.',
                solution: 'Vi m√• verdsette "Produktivt Strev" over umiddelbar komfort.'
            },
            'helplessness': {
                title: 'L√¶rt Hjelpel√∏shet',
                content: 'N√•r voksne l√∏ser problemer for barnet f√∏r barnet har pr√∏vd selv. Resultatet er passivitet og manglende tro p√• egne evner.',
                solution: 'Vi m√• ansvarliggj√∏re elevene for egen l√¶ring (Agens).'
            }
        };

        const practiceData = {
            traditional: {
                colors: 'border-slate-300',
                tid: 'Fragmentert og klokkestyrt hverdag.',
                rolle: 'Instrukt√∏r og probleml√∏ser.',
                vurdering: 'Prestasjonsfokus (karakterer).',
                ansvar: 'Risikoaversjon (Unng√• feil).'
            },
            robust: {
                colors: 'border-orange-500',
                tid: 'Dybdeorientert: Tid til flyt.',
                rolle: 'Veileder: St√∏tter prosessen, ikke svaret.',
                vurdering: 'Prosessfokus: Vekst og innsats.',
                ansvar: 'Ansvarliggj√∏ring: Eleven eier l√¶ringen.'
            }
        };

        const zoneDescriptions = {
            'Comfort': {
                title: 'Komfortsonen / Kjedsomhet',
                desc: 'Lav utfordring, h√∏y st√∏tte. Her f√∏ler eleven seg trygg, men l√¶rer lite nytt. Faren er apati.',
                strategy: '√òk kravene! Introduser mer komplekse problemer som krever tenking.'
            },
            'Panic': {
                title: 'Panikksonen / Overveldelse',
                desc: 'H√∏y utfordring, lav st√∏tte. Eleven mangler verkt√∏yene til √• l√∏se oppgaven. Faren er angst og aversjon.',
                strategy: '√òk stillasbyggingen (st√∏tten). Bryt ned oppgaven, men ikke fjern problemet.'
            },
            'Robust': {
                title: 'ROBUST L√¶ringssonen',
                desc: 'H√∏y utfordring, H√∏y st√∏tte. "Optimal Angst". Her skjer den dype l√¶ringen gjennom produktivt strev.',
                strategy: 'Hold eleven her! Gi emosjonell st√∏tte ("Dette klarer du"), men ikke kognitiv avlastning (ikke gi svaret).'
            }
        };

        // --- NAVIGATION & INTERACTION ---
        
        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
            // Update active state simplified
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active-nav', 'border-b-2', 'border-orange-600', 'text-orange-600'));
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        // Section 1 Logic
        function updateDiagnosisDetails(key) {
            const container = document.getElementById('diagnosis-detail');
            const data = diagnosisData[key];
            
            // Fade out, update, fade in
            container.classList.remove('fade-in');
            void container.offsetWidth; // trigger reflow
            
            document.getElementById('diag-title').innerText = data.title;
            document.getElementById('diag-content').innerText = data.content;
            document.getElementById('diag-solution').innerText = data.solution;
            
            container.classList.remove('hidden');
            container.classList.add('fade-in');
        }

        // Section 3 Logic
        function setMode(mode) {
            const data = practiceData[mode];
            const btnTrad = document.getElementById('btn-trad');
            const btnRobust = document.getElementById('btn-robust');
            
            // Button styles
            if (mode === 'robust') {
                btnRobust.classList.add('bg-orange-600', 'text-white');
                btnRobust.classList.remove('text-slate-500', 'bg-transparent', 'hover:text-orange-600');
                
                btnTrad.classList.remove('bg-slate-100', 'text-slate-500');
                btnTrad.classList.add('text-slate-400', 'bg-transparent', 'hover:text-slate-600');
            } else {
                btnTrad.classList.add('bg-slate-100', 'text-slate-500');
                btnTrad.classList.remove('text-slate-400', 'bg-transparent', 'hover:text-slate-600');
                
                btnRobust.classList.remove('bg-orange-600', 'text-white');
                btnRobust.classList.add('text-slate-500', 'bg-transparent', 'hover:text-orange-600');
            }

            // Update Cards
            const cards = ['tid', 'rolle', 'vurdering', 'ansvar'];
            cards.forEach(key => {
                const card = document.getElementById(`card-${key}`);
                const p = card.querySelector('.content-text');
                
                // Animate change
                card.style.opacity = '0.5';
                setTimeout(() => {
                    p.innerText = data[key];
                    card.classList.remove('border-slate-300', 'border-orange-500');
                    card.classList.add(data.colors);
                    card.style.opacity = '1';
                }, 200);
            });
        }

        // --- CHARTS ---
        document.addEventListener('DOMContentLoaded', function() {
            // Growth Matrix (Bubble Chart)
            const ctx = document.getElementById('growthChart').getContext('2d');
            
            const growthChart = new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'L√¶ringssoner',
                        data: [
                            { x: 2, y: 8, r: 25, zone: 'Comfort' },   // Low Challenge, High Support (Actually boring/comfort)
                            { x: 8, y: 2, r: 25, zone: 'Panic' },     // High Challenge, Low Support
                            { x: 8, y: 8, r: 40, zone: 'Robust' }     // High Challenge, High Support
                        ],
                        backgroundColor: function(context) {
                            const val = context.raw?.zone;
                            if(val === 'Robust') return 'rgba(234, 88, 12, 0.8)'; // Orange
                            if(val === 'Panic') return 'rgba(248, 113, 113, 0.6)'; // Red
                            return 'rgba(203, 213, 225, 0.8)'; // Slate/Grey
                        }
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: { display: true, text: 'Utfordring (Kognitivt Krav)', font: {weight: 'bold'} },
                            min: 0, max: 10,
                            grid: { color: '#f1f5f9' }
                        },
                        y: {
                            title: { display: true, text: 'St√∏tte (Stillasbygging)', font: {weight: 'bold'} },
                            min: 0, max: 10,
                            grid: { color: '#f1f5f9' }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return zoneDescriptions[context.raw.zone].title;
                                }
                            }
                        },
                        legend: { display: false }
                    },
                    onClick: (e) => {
                        const points = growthChart.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true);
                        if (points.length) {
                            const firstPoint = points[0];
                            const zoneKey = growthChart.data.datasets[firstPoint.datasetIndex].data[firstPoint.index].zone;
                            
                            // Update info box
                            const infoBox = document.getElementById('zone-info');
                            const data = zoneDescriptions[zoneKey];
                            
                            infoBox.innerHTML = `
                                <h4 class="font-bold text-lg text-slate-900 mb-2">${data.title}</h4>
                                <p class="text-slate-700 mb-3">${data.desc}</p>
                                <div class="bg-white p-3 rounded border-l-4 border-orange-500">
                                    <span class="font-bold text-xs uppercase text-slate-500">L√¶rerstrategi:</span><br>
                                    <span class="text-sm text-slate-800">${data.strategy}</span>
                                </div>
                            `;
                            
                            // Highlight visuals
                            if (zoneKey === 'Robust') {
                                infoBox.className = "bg-orange-50 p-6 rounded-lg border border-orange-200 shadow-md transition-all";
                            } else {
                                infoBox.className = "bg-white p-6 rounded-lg border border-slate-200 shadow-sm transition-all";
                            }
                        }
                    }
                }
            });
            
            // Initialize with ROBUST mode active in UI for visual pop, but logic handles toggle
            setMode('traditional'); // Start traditional to show the "before" state
        });
    </script>
</body>
</html>
